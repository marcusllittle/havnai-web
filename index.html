<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      // Expose API base for static deployments (matches Next.js env)
      window.NEXT_PUBLIC_API_BASE_URL = "/api";
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HavnAI Network — Own Your Intelligence</title>
    <meta
      name="description"
      content="HavnAI is a decentralized GPU network where creators earn $HAI running AI models."
    />
    <meta property="og:title" content="HavnAI Network — Own Your Intelligence" />
    <meta
      property="og:description"
      content="A decentralized GPU network with weighted model routing and dynamic $HAI rewards."
    />
    <meta property="og:type" content="website" />
    <link rel="icon" type="image/png" href="/HavnAI-logo.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Exo+2:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="site-body">
    <div class="bg-aurora"></div>
    <header class="site-header">
      <div class="header-inner">
        <a href="#home" class="brand">
          <img src="/HavnAI-logo.png" alt="HavnAI" class="brand-logo" />
          <div class="brand-text">
            <span class="brand-stage">Stage 6 → 7 Alpha</span>
            <span class="brand-name">HavnAI Network</span>
          </div>
        </a>
        <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
          <span></span><span></span>
        </button>
        <nav class="nav-links" id="primaryNav">
          <a href="#home">Home</a>
          <a href="#how">How It Works</a>
          <a href="#smart-routing">Smart Routing</a>
          <a href="#rewards">Rewards</a>
          <a href="#models">Models</a>
          <a href="http://api.joinhavn.io:5001/dashboard" target="_blank">Dashboard</a>
          <a href="#join">Join Alpha</a>
          <a
            href="https://www.patreon.com/cw/u38989793"
            target="_blank"
            rel="noreferrer"
            class="nav-patreon"
          >
            Patreon
          </a>
        </nav>
      </div>
    </header>

    <main>
      <!-- HERO -->
      <section id="home" class="hero">
        <div class="hero-inner">
          <div class="hero-content">
            <p class="hero-kicker">Decentralized GPU Intelligence</p>
            <h1 class="hero-title">OWN YOUR INTELLIGENCE</h1>
            <p class="hero-subtitle">
              A decentralized GPU network where creators earn
              <strong>$HAI</strong> running AI models. Weighted routing, benchmark-driven
              model tiers, and live rewards.
            </p>
            <div class="hero-install-note">
              <h3>Join the HavnAI GPU Grid</h3>
              <p>
                Run this on your GPU machine to install the node:
              </p>
              <pre><code>curl -fsSL http://api.joinhavn.io:5001/installers/install-node.sh \
  | bash -s -- --server http://api.joinhavn.io:5001</code></pre>
              <p>
                Full prerequisites, WAN I2V setup, systemd steps, and troubleshooting live on the
                coordinator’s install guide.
              </p>
              <a
                href="http://api.joinhavn.io:5001/join"
                target="_blank"
                rel="noreferrer"
                class="btn tertiary wide"
              >
                Open full node install guide
              </a>
            </div>
          </div>
          <div class="hero-panel">
            <div class="stat-grid">
              <div class="stat-card">
                <span class="stat-label">Active Nodes</span>
                <span class="stat-value" id="heroActiveNodes">--</span>
              </div>
              <div class="stat-card">
                <span class="stat-label">Jobs (24h)</span>
                <span class="stat-value" id="heroJobs24h">--</span>
              </div>
              <div class="stat-card">
                <span class="stat-label">Success Rate</span>
                <span class="stat-value" id="heroSuccessRate">--%</span>
              </div>
              <div class="stat-card">
                <span class="stat-label">Top Model</span>
                <span class="stat-value small" id="heroTopModel">--</span>
              </div>
            </div>
            <div class="stat-footnote">
              Backed by <code>/api/models/stats</code> from the live coordinator.
            </div>
          </div>
        </div>
      </section>

      <!-- HOW IT WORKS -->
      <section id="how" class="section">
        <div class="section-header">
          <h2>How It Works</h2>
          <p>From GPU to $HAI rewards in four concrete steps.</p>
        </div>
        <div class="steps-grid">
          <article class="step-card">
            <div class="step-icon">1</div>
            <h3>Connect Your GPU Node</h3>
            <p>
              Point the HavnAI node client at the coordinator, set your wallet, and enable
              <code>CREATOR_MODE</code> to accept image/video jobs.
            </p>
          </article>
          <article class="step-card">
            <div class="step-icon">2</div>
            <h3>Receive AI Jobs</h3>
            <p>
              The coordinator queues jobs submitted to <code>/submit-job</code> and assigns them
              only to compatible, healthy nodes.
            </p>
          </article>
          <article class="step-card">
            <div class="step-icon">3</div>
            <h3>Run Models with Weighted Routing</h3>
            <p>
              Models are chosen with weighted random routing, favoring higher-tier, benchmarked
              checkpoints.
            </p>
          </article>
          <article class="step-card">
            <div class="step-icon">4</div>
            <h3>Earn $HAI Automatically</h3>
            <p>
              Each completed job records runtime, model weight, and quality tier to scale your
              $HAI rewards.
            </p>
          </article>
        </div>
      </section>

      <!-- SMART ROUTING -->
      <section id="smart-routing" class="section section-alt">
        <div class="section-header">
          <h2>Smart Routing · Weighted Models</h2>
          <p>
            Identical prompts, benchmark scores, and a registry-backed weight for every creator model.
          </p>
        </div>
        <div class="routing-layout">
          <div class="routing-copy">
            <p>
              When a user hits <code>/submit-job</code> with <code>"model": "auto"</code>, the
              coordinator selects a model using weighted random routing. Weights are derived from a
              benchmark → scoring → registry workflow:
            </p>
            <ul>
              <li>Standardized prompts per domain (realism, anime, motion, text).</li>
              <li>Rubric scoring → tier assignment (Tier 5 → Tier 1).</li>
              <li>Tier ↔ target weight ↔ reward multiplier.</li>
            </ul>
            <p>
              The result: more reliable, higher-quality models are chosen more often and rewarded more
              aggressively in $HAI.
            </p>
          </div>
          <div class="json-card">
            <div class="json-card-label">Example routing weights</div>
            <pre><code>{
  "juggernautxl_ragnarokby": 77,
  "majicmixRealistic_v7": 70,
  "lazymixRealAmateur_v40": 55,
  "perfectdeliberate_v5SD15": 50,
  "epicrealismxl_vxviicrystalclear": 45
}</code></pre>
          </div>
        </div>
      </section>

      <!-- REWARDS -->
      <section id="rewards" class="section">
        <div class="section-header">
          <h2>Dynamic $HAI Rewards</h2>
          <p>Weight tiers drive multipliers. Better models, bigger payouts.</p>
        </div>
        <div class="table-wrapper">
          <table class="rewards-table">
            <thead>
              <tr>
                <th>Tier</th>
                <th>Routing Weight</th>
                <th>Reward Multiplier</th>
                <th>Example Model</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>5</td>
                <td>77</td>
                <td>2.0×</td>
                <td>juggernautXL</td>
              </tr>
              <tr>
                <td>4</td>
                <td>70</td>
                <td>1.7×</td>
                <td>majicmix</td>
              </tr>
              <tr>
                <td>3</td>
                <td>55</td>
                <td>1.3×</td>
                <td>lazymix</td>
              </tr>
              <tr>
                <td>2</td>
                <td>50</td>
                <td>1.1×</td>
                <td>deliberate</td>
              </tr>
              <tr>
                <td>1</td>
                <td>45</td>
                <td>1.0×</td>
                <td>epicrealism</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- MODEL SHOWCASE -->
      <section id="models" class="section section-alt">
        <div class="section-header">
          <h2>Live Model Catalog</h2>
          <p>
            Models, weights, and tags pulled directly from the coordinator via
            <code>/api/models/stats</code>.
          </p>
        </div>
        <div class="model-grid" id="modelGrid">
          <div class="model-card placeholder">
            <p class="model-name">Loading models…</p>
            <p class="model-weight">Weight —</p>
            <p class="model-desc">
              Once the coordinator responds, you’ll see the live registry here.
            </p>
          </div>
        </div>
      </section>

      <!-- LIVE JOBS SNAPSHOT -->
      <section class="section live-section">
        <div class="section-header">
          <h2>Live Jobs Snapshot</h2>
          <p>Recent public jobs, straight from the grid.</p>
        </div>
        <div class="live-layout">
          <div class="table-wrapper">
            <table class="jobs-table">
              <thead>
                <tr>
                  <th>Job</th>
                  <th>Model</th>
                  <th>Reward</th>
                  <th>Status</th>
                  <th>Preview</th>
                </tr>
              </thead>
              <tbody id="jobsTableBody">
                <tr>
                  <td colspan="5">Waiting for recent jobs from /api/models/stats…</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="live-summary">
            <h3>Network Pulse</h3>
            <ul>
              <li><span>Active nodes</span><strong id="liveActiveNodes">--</strong></li>
              <li><span>Jobs (24h)</span><strong id="liveJobs24h">--</strong></li>
              <li><span>Success rate</span><strong id="liveSuccessRate">--%</strong></li>
            </ul>
          </div>
        </div>
      </section>

      <!-- JOIN / ALPHA -->
      <section id="join" class="section join-section">
        <div class="join-inner">
          <div class="join-copy">
            <h2>Join Stage 6 → 7 Alpha</h2>
            <p>
              We are validating weighted routing, benchmark-driven tiers, and the reward engine
              across a small set of GPUs before opening the grid. If you are comfortable running
              bleeding-edge AI infra, we want you in the loop.
            </p>
            <ul>
              <li>12&nbsp;GB+ NVIDIA GPU (3060 / 3080 / 4090 class).</li>
              <li>Solid upstream bandwidth and uptime.</li>
              <li>Willingness to iterate on configs and report issues.</li>
            </ul>
          </div>
          <div class="join-actions">
            <a href="https://joinhavn.io/alpha" class="btn primary wide">Join Alpha (Typeform)</a>
            <a href="http://api.joinhavn.io:5001/dashboard" class="btn tertiary wide"
              >View Live Dashboard</a
            >
            <p class="join-note">
              After joining, you’ll receive updated install + config steps tailored to your GPU
              and OS.
            </p>
          </div>
        </div>
      </section>
    </main>

    <!-- FOOTER -->
    <footer class="site-footer">
      <div class="footer-inner footer-layout">
        <div class="footer-col footer-col-left">
          <div class="footer-brand">
            <img src="/HavnAI-logo.png" alt="HavnAI" class="footer-logo" />
            <div>
              <div class="footer-brand-name">HavnAI</div>
              <p class="footer-tagline">Decentralized GPU network for AI creators.</p>
            </div>
          </div>
          <p class="footer-copy">© 2025 HavnAI Network</p>
        </div>

        <div class="footer-col footer-col-center">
          <h4>Docs &amp; Code</h4>
          <ul>
            <li>
              <a href="https://github.com/marcusllittle/havnai-core" target="_blank" rel="noreferrer"
                >havnai-core</a
              >
            </li>
            <li>
              <a href="https://github.com/marcusllittle/havnai-node" target="_blank" rel="noreferrer"
                >havnai-node</a
              >
            </li>
            <li>
              <a href="https://github.com/marcusllittle/havnai-web" target="_blank" rel="noreferrer"
                >havnai-web</a
              >
            </li>
          </ul>
        </div>

        <div class="footer-col footer-col-right">
          <h4>Contact</h4>
          <a class="footer-email" href="mailto:support@joinhavn.io">support@joinhavn.io</a>
          <a
            class="footer-patreon-btn"
            href="https://www.patreon.com/cw/u38989793"
            target="_blank"
            rel="noreferrer"
          >
            Exclusive Drops on Patreon
          </a>
        </div>
      </div>
    </footer>

    <script>
      (function () {
        const API_BASE = window.NEXT_PUBLIC_API_BASE_URL || "/api";

        // Responsive nav
        const navToggle = document.getElementById("navToggle");
        const primaryNav = document.getElementById("primaryNav");
        navToggle.addEventListener("click", () => {
          primaryNav.classList.toggle("nav-open");
          navToggle.classList.toggle("nav-open");
        });

        // Fetch stats + registry + jobs from /api/models/stats
        const heroActiveNodes = document.getElementById("heroActiveNodes");
        const heroJobs24h = document.getElementById("heroJobs24h");
        const heroSuccessRate = document.getElementById("heroSuccessRate");
        const heroTopModel = document.getElementById("heroTopModel");

        const liveActiveNodes = document.getElementById("liveActiveNodes");
        const liveJobs24h = document.getElementById("liveJobs24h");
        const liveSuccessRate = document.getElementById("liveSuccessRate");

        const modelGrid = document.getElementById("modelGrid");
        const jobsTableBody = document.getElementById("jobsTableBody");

        const sampleStats = {
          active_nodes: 0,
          jobs_completed_24h: 0,
          success_rate: 0,
          top_model: "—",
          model_registry: [],
          recent_jobs: [],
        };

        function safeArray(value) {
          return Array.isArray(value) ? value : [];
        }

        function renderStats(data) {
          const nodes = data.active_nodes ?? sampleStats.active_nodes;
          const jobs = data.jobs_completed_24h ?? sampleStats.jobs_completed_24h;
          const success = data.success_rate ?? sampleStats.success_rate;
          const topModel = data.top_model ?? sampleStats.top_model;

          heroActiveNodes.textContent = nodes;
          heroJobs24h.textContent = jobs;
          heroSuccessRate.textContent = typeof success === "number" ? success.toFixed(1) + "%" : success;
          heroTopModel.textContent = topModel || "—";

          liveActiveNodes.textContent = nodes;
          liveJobs24h.textContent = jobs;
          liveSuccessRate.textContent = typeof success === "number" ? success.toFixed(1) + "%" : success;
        }

        function renderModels(registry) {
          const models = safeArray(registry);
          if (!models.length) {
            modelGrid.innerHTML =
              '<div class="model-card placeholder"><p class="model-name">No models registered yet.</p><p class="model-weight">Weight —</p><p class="model-desc">Once the coordinator exposes the registry, models will appear here automatically.</p></div>';
            return;
          }

          const cards = models
            .sort((a, b) => (b.weight || 0) - (a.weight || 0))
            .slice(0, 12)
            .map((entry) => {
              const name = entry.name || entry.model || "unnamed-model";
              const weight = entry.weight ?? entry.reward_weight ?? 0;
              const tags = safeArray(entry.tags);
              const description =
                entry.description ||
                (tags.length ? "Tagged: " + tags.join(", ") : "Creator model registered on the grid.");
              const preview = entry.preview_url || "/HavnAI-logo.png";
              return `
                <article class="model-card">
                  <div class="model-preview">
                    <img src="${preview}" alt="${name} preview" loading="lazy" />
                  </div>
                  <div class="model-body">
                    <h3 class="model-name">${name}</h3>
                    <p class="model-weight">Weight: <strong>${weight}</strong></p>
                    <p class="model-desc">${description}</p>
                    ${
                      tags.length
                        ? `<div class="model-tags">${tags
                            .slice(0, 4)
                            .map((t) => `<span class="tag">${t}</span>`)
                            .join("")}</div>`
                        : ""
                    }
                  </div>
                </article>
              `;
            })
            .join("");

          modelGrid.innerHTML = cards;
        }

        function renderJobs(jobs) {
          const list = safeArray(jobs);
          if (!list.length) {
            jobsTableBody.innerHTML =
              '<tr><td colspan="5">No recent public jobs reported yet.</td></tr>';
            return;
          }

          const rows = list
            .slice(0, 10)
            .map((job) => {
              const id = job.job_id || job.id || "—";
              const model = job.model || "—";
              const reward =
                typeof job.reward_hai === "number"
                  ? job.reward_hai.toFixed(6)
                  : typeof job.reward === "number"
                  ? job.reward.toFixed(6)
                  : "—";
              const status = (job.status || "UNKNOWN").toString().toUpperCase();
              const imageUrl = job.image_url || job.preview_url || "";
              const preview = imageUrl
                ? `<button class="preview-thumb" data-preview="${imageUrl}" aria-label="Open preview for ${id}">
                    <img src="${imageUrl}" alt="${id} preview" loading="lazy" />
                  </button>`
                : "—";
              return `
                <tr>
                  <td><code>${id}</code></td>
                  <td>${model}</td>
                  <td>${reward || "—"}</td>
                  <td>${status}</td>
                  <td>${preview}</td>
                </tr>
              `;
            })
            .join("");

          jobsTableBody.innerHTML = rows;
        }

        async function loadStats() {
          try {
            const res = await fetch(API_BASE + "/models/stats", { credentials: "same-origin" });
            if (!res.ok) throw new Error("stats HTTP " + res.status);
            const data = await res.json();
            renderStats(data);
            renderModels(data.model_registry || data.models || []);
            renderJobs(data.recent_jobs || []);
          } catch (err) {
            console.error("Failed to load /api/models/stats", err);
            renderStats(sampleStats);
            renderModels(sampleStats.model_registry);
            renderJobs(sampleStats.recent_jobs);
          }
        }

        loadStats();
        setInterval(loadStats, 15000);

        // Simple lightbox for job previews (reused by dashboard if needed)
        const body = document.body;
        function ensureLightbox() {
          let lb = document.getElementById("lightbox");
          if (!lb) {
            lb = document.createElement("div");
            lb.id = "lightbox";
            lb.className = "lightbox hidden";
            lb.innerHTML =
              '<div class="lightbox-backdrop"></div><div class="lightbox-content"><img alt="Preview" /><button class="lightbox-close" aria-label="Close preview">×</button></div>';
            body.appendChild(lb);
            lb.addEventListener("click", (evt) => {
              if (
                evt.target === lb ||
                evt.target.classList.contains("lightbox-backdrop") ||
                evt.target.classList.contains("lightbox-close")
              ) {
                lb.classList.add("hidden");
              }
            });
          }
          return lb;
        }

        jobsTableBody.addEventListener("click", (evt) => {
          const btn = evt.target.closest(".preview-thumb");
          if (!btn) return;
          const src = btn.getAttribute("data-preview");
          if (!src) return;
          const lb = ensureLightbox();
          const img = lb.querySelector("img");
          img.src = src;
          lb.classList.remove("hidden");
        });
      })();
    </script>
  </body>
</html>
